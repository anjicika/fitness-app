name: Backend Linting

on:
  push:
    branches:
      - main
      - develop
      - "feature/**"
    paths:
      - "backend/**"
      - ".github/workflows/backend-lint.yml"
  pull_request:
    branches:
      - main
      - develop
    paths:
      - "backend/**"

jobs:
  lint:
    name: Run ESLint & Prettier
    runs-on: ubuntu-latest

    steps:
      # 1. Checkout code
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4

      # 2. Setup Node.js
      - name: ğŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "18"
          cache: "npm"
          cache-dependency-path: backend/package-lock.json

      # 3. Install dependencies
      - name: ğŸ“¦ Install dependencies
        working-directory: ./backend
        run: npm ci

      # 4. Run ESLint
      - name: ğŸ” Run ESLint
        working-directory: ./backend
        run: npm run lint

      # 5. Check Prettier formatting
      - name: ğŸ’… Check Prettier formatting
        working-directory: ./backend
        run: npx prettier --check "**/*.{js,json,md}"

      # 6. Report results
      - name: âœ… Linting passed
        if: success()
        run: echo "âœ… All linting checks passed!"

      - name: âŒ Linting failed
        if: failure()
        run: |
          echo "âŒ Linting failed. Please fix the issues and try again."
          echo "Run 'npm run lint:fix' to auto-fix some issues."
